<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é©¬é‡Œå¥¥å•è¯æ¸¸æˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      min-height: 100vh;
      background: linear-gradient(to bottom, #60a5fa, #93c5fd, #4ade80);
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* äº‘æœµè£…é¥° */
    .cloud {
      position: absolute;
      background: white;
      border-radius: 100px;
      opacity: 0.8;
    }
    .cloud1 { top: 40px; left: 40px; width: 96px; height: 48px; }
    .cloud2 { top: 80px; right: 80px; width: 128px; height: 64px; }
    .cloud3 { top: 160px; left: 33%; width: 112px; height: 56px; }

    .container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
      z-index: 10;
    }

    /* å¾—åˆ†æ¿ */
    .scoreboard {
      background: #facc15;
      border: 4px solid #ca8a04;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .score {
      font-size: 24px;
      font-weight: bold;
      color: #78350f;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .buttons {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      color: white;
    }

    .btn:hover {
      transform: scale(1.05);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn-purple { background: #a855f7; }
    .btn-purple:hover { background: #9333ea; }
    .btn-red { background: #ef4444; }
    .btn-red:hover { background: #dc2626; }
    .btn-blue { background: #3b82f6; }
    .btn-blue:hover { background: #2563eb; }
    .btn-green { background: #22c55e; }
    .btn-green:hover { background: #16a34a; }
    .btn-yellow { background: #facc15; }
    .btn-yellow:hover { background: #eab308; }
    .btn-gray { background: #9ca3af; }
    .btn-gray:hover { background: #6b7280; }

    /* å•è¯ç®¡ç†é¢æ¿ */
    .word-manager {
      background: white;
      border: 4px solid #a855f7;
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
      display: none;
    }

    .word-manager.active {
      display: block;
    }

    .manager-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .manager-header h2 {
      color: #a855f7;
      font-size: 24px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
    }

    .word-form {
      background: #f3e8ff;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
    }

    .input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .word-input {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid #d8b4fe;
      border-radius: 8px;
      font-size: 14px;
    }

    .word-input:focus {
      outline: none;
      border-color: #a855f7;
    }

    .word-list {
      max-height: 256px;
      overflow-y: auto;
    }

    .word-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f9fafb;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .word-item:hover {
      background: #f3f4f6;
    }

    .word-text {
      flex: 1;
    }

    .word-en {
      font-weight: bold;
      color: #2563eb;
    }

    .word-cn {
      color: #374151;
    }

    .word-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      padding: 8px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
    }

    /* ä¸»æ¸¸æˆåŒº */
    .game-area {
      background: white;
      border: 4px solid #1f2937;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.3);
    }

    .sound-btn {
      background: #3b82f6;
      border: none;
      color: white;
      padding: 16px 32px;
      border-radius: 9999px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 0 auto 32px;
      transition: all 0.2s;
    }

    .sound-btn:hover {
      background: #2563eb;
      transform: scale(1.1);
    }

    .sound-btn:active {
      transform: scale(0.95);
    }

    .sound-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .hint {
      text-align: center;
      color: #6b7280;
      margin-bottom: 32px;
    }

    /* ç­”æ¡ˆåŒº */
    .answer-area {
      min-height: 80px;
      background: #fef3c7;
      border: 4px solid #eab308;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 32px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      align-items: center;
    }

    .placeholder {
      color: #9ca3af;
      font-size: 20px;
    }

    .letter-btn {
      width: 56px;
      height: 56px;
      border: none;
      border-radius: 8px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
      transition: all 0.2s;
    }

    .letter-btn:hover:not(:disabled) {
      transform: scale(1.1);
    }

    .letter-btn:active:not(:disabled) {
      transform: scale(0.95);
    }

    .letter-btn.answer {
      background: #22c55e;
      color: white;
    }

    .letter-btn.answer:hover {
      background: #16a34a;
    }

    .letter-btn.choice {
      background: #ef4444;
      color: white;
    }

    .letter-btn.choice:hover {
      background: #dc2626;
    }

    .letter-btn:disabled {
      background: #d1d5db;
      color: #6b7280;
      cursor: not-allowed;
    }

    /* å­—æ¯é€‰æ‹©åŒº */
    .letters-area {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    /* æˆåŠŸæç¤º */
    .success-msg {
      margin-top: 24px;
      background: #22c55e;
      border: 4px solid #15803d;
      border-radius: 8px;
      padding: 16px;
      text-align: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 8px;
      animation: bounce 1s infinite;
    }

    .success-msg.active {
      display: flex;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    /* ç –å—è£…é¥° */
    .bricks {
      margin-top: 32px;
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .brick {
      width: 64px;
      height: 64px;
      background: #ca8a04;
      border: 4px solid #78350f;
      border-radius: 4px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.2);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .pulse {
      animation: pulse 1s infinite;
    }
  </style>
</head>
<body>
  <div class="cloud cloud1"></div>
  <div class="cloud cloud2"></div>
  <div class="cloud cloud3"></div>

  <div class="container">
    <!-- å¾—åˆ†æ¿ -->
    <div class="scoreboard">
      <div class="score">
        <span>â­</span>
        <span>åˆ†æ•°: <span id="score">0</span></span>
      </div>
      <div class="buttons">
        <button class="btn btn-purple" onclick="toggleWordManager()">
          âœï¸ å•è¯åº“
        </button>
        <button class="btn btn-red" onclick="resetGame()">
          ğŸ”„ é‡æ–°å¼€å§‹
        </button>
      </div>
    </div>

    <!-- å•è¯ç®¡ç†é¢æ¿ -->
    <div id="wordManager" class="word-manager">
      <div class="manager-header">
        <h2>å•è¯åº“ç®¡ç†</h2>
        <button class="close-btn" onclick="toggleWordManager()">âœ–</button>
      </div>

      <div class="word-form">
        <div class="input-group">
          <input type="text" id="englishInput" class="word-input" placeholder="è‹±æ–‡å•è¯">
          <input type="text" id="chineseInput" class="word-input" placeholder="ä¸­æ–‡æ„æ€">
        </div>
        <div class="input-group">
          <button id="addBtn" class="btn btn-blue" onclick="addWord()" style="flex: 1;">
            â• æ·»åŠ å•è¯
          </button>
          <button id="saveBtn" class="btn btn-green" onclick="saveEdit()" style="flex: 1; display: none;">
            ğŸ’¾ ä¿å­˜ä¿®æ”¹
          </button>
          <button id="cancelBtn" class="btn btn-gray" onclick="cancelEdit()" style="flex: 1; display: none;">
            å–æ¶ˆ
          </button>
        </div>
      </div>

      <div id="wordList" class="word-list"></div>
      <p style="margin-top: 16px; color: #6b7280; font-size: 14px;">
        å…± <span id="wordCount">0</span> ä¸ªå•è¯
      </p>
    </div>

    <!-- ä¸»æ¸¸æˆåŒº -->
    <div class="game-area">
      <button id="soundBtn" class="sound-btn" onclick="playSound()">
        <span id="soundIcon">ğŸ”Š</span>
        <span id="chineseWord">åŠ è½½ä¸­...</span>
      </button>
      <p class="hint">ç‚¹å‡»å¬å‘éŸ³</p>

      <!-- ç­”æ¡ˆåŒº -->
      <div id="answerArea" class="answer-area">
        <span class="placeholder">ç‚¹å‡»ä¸‹æ–¹å­—æ¯å¼€å§‹æ‹¼å†™...</span>
      </div>

      <!-- å­—æ¯é€‰æ‹©åŒº -->
      <div id="lettersArea" class="letters-area"></div>

      <!-- æˆåŠŸæç¤º -->
      <div id="successMsg" class="success-msg">
        <span>ğŸ†</span>
        <span>å¤ªæ£’äº†ï¼+10åˆ†</span>
        <span>ğŸ†</span>
      </div>
    </div>

    <!-- ç –å—è£…é¥° -->
    <div class="bricks">
      <div class="brick"></div>
      <div class="brick"></div>
      <div class="brick"></div>
      <div class="brick"></div>
      <div class="brick"></div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { 
    getFirestore, 
    doc, 
    getDoc, 
    setDoc 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyDsVWuA03ZpYENxAj1JPnffrG3Ptkl9wyQ",
    authDomain: "wordgame-4f738.firebaseapp.com",
    projectId: "wordgame-4f738",
    storageBucket: "wordgame-4f738.firebasestorage.app",
    messagingSenderId: "840109786086",
    appId: "1:840109786086:web:96a65fdcfb97a95cdccc27"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const wordDocRef = doc(db, "wordGame", "dictionary");

  // -------------------------
  // ğŸ”¥ åˆå§‹å•è¯ï¼ˆç¬¬ä¸€æ¬¡å†™å…¥ï¼‰
  // -------------------------
  let words = [
    { english: 'attempt', chinese: 'å°è¯•' },
    { english: 'hospitality', chinese: 'çƒ­æƒ…å¥½å®¢' },
    { english: 'firmly', chinese: 'åšå®šåœ°ï¼ˆç¡®å®šï¼‰' },
    { english: 'inattention', chinese: 'å¿½ç•¥' },
    { english: 'neglect', chinese: 'å¿½ç•¥' },
    { english: 'eliminate', chinese: 'æ¶ˆé™¤' },
    { english: 'stay away', chinese: 'æ²¡æœ‰å‡ºå¸­' },
    { english: 'conducive', chinese: 'é€‚åˆ' },
    { english: 'compliance', chinese: 'æœä»' }
  ];

  let currentWordIndex = 0;
  let score = 0;
  let userAnswer = [];
  let shuffledLetters = [];
  let editingIndex = null;
  let hasWordLibAccess = false;

  const WORD_LIB_PASSWORD = "0249";

  // -------------------------
  // ğŸ”¥ Firestore : è¯»å–å•è¯åº“
  // -------------------------
  async function loadWordsFromServer() {
    const snapshot = await getDoc(wordDocRef);
    if (snapshot.exists()) {
      words = snapshot.data().list;
    } else {
      await setDoc(wordDocRef, { list: words });
    }
  }

  // -------------------------
  // ğŸ”¥ Firestoreï¼šä¿å­˜å•è¯åº“
  // -------------------------
  async function saveWordsToServer() {
    await setDoc(wordDocRef, { list: words });
  }

  // -------------------------
  // ğŸ® åˆå§‹åŒ–æ¸¸æˆ
  // -------------------------
  async function initGame() {
    await loadWordsFromServer();
    renderWordList();
    shuffleLetters();
  }

  // -------------------------
  // ğŸ® æ¸¸æˆé€»è¾‘ï¼ˆä½ çš„åŸç‰ˆï¼‰
  // -------------------------
  function shuffleLetters() {
    const word = words[currentWordIndex];
    document.getElementById('chineseWord').textContent = word.chinese;

    const letters = word.english.split('');
    shuffledLetters = letters
      .map((letter, index) => ({ letter, id: index, used: false }))
      .sort(() => Math.random() - 0.5);

    userAnswer = [];
    renderGame();
  }

  function renderGame() {
    const answerArea = document.getElementById('answerArea');
    if (userAnswer.length === 0) {
      answerArea.innerHTML = '<span class="placeholder">ç‚¹å‡»ä¸‹æ–¹å­—æ¯å¼€å§‹æ‹¼å†™...</span>';
    } else {
      answerArea.innerHTML = userAnswer
        .map((obj, index) => 
          `<button class="letter-btn answer" onclick="removeFromAnswer(${index})">${obj.letter}</button>`
        )
        .join('');
    }

    const lettersArea = document.getElementById('lettersArea');
    lettersArea.innerHTML = shuffledLetters
      .map((obj) => 
        `<button class="letter-btn choice" 
          onclick="addToAnswer(${obj.id})" 
          ${obj.used ? 'disabled' : ''}>
          ${obj.letter}
        </button>`
      )
      .join('');
  }

  window.addToAnswer = function(id) {
    const letterObj = shuffledLetters.find(l => l.id === id);
    if (letterObj.used) return;

    userAnswer.push(letterObj);
    letterObj.used = true;
    renderGame();

    if (userAnswer.length === words[currentWordIndex].english.length) {
      checkAnswer();
    }
  }

  window.removeFromAnswer = function(index) {
    const letterObj = userAnswer[index];
    userAnswer.splice(index, 1);

    const found = shuffledLetters.find(l => l.id === letterObj.id);
    found.used = false;

    renderGame();
  }

  function checkAnswer() {
    const userWord = userAnswer.map(l => l.letter).join('');
    const correctWord = words[currentWordIndex].english;

    if (userWord === correctWord) {
      score += 10;
      document.getElementById('score').textContent = score;

      const successMsg = document.getElementById('successMsg');
      successMsg.classList.add('active');

      setTimeout(() => {
        successMsg.classList.remove('active');
        nextWord();
      }, 1500);
    }
  }

  function nextWord() {
    currentWordIndex = (currentWordIndex + 1) % words.length;
    shuffleLetters();
  }

  window.resetGame = function() {
    currentWordIndex = 0;
    score = 0;
    document.getElementById('score').textContent = score;
    shuffleLetters();
  }

  window.playSound = function() {
    const utterance = new SpeechSynthesisUtterance(words[currentWordIndex].english);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    window.speechSynthesis.speak(utterance);
  }

  // -------------------------
  // ğŸŸ£ å•è¯ç®¡ç†ï¼ˆå·²åŠ å…¥ Firebaseï¼‰
  // -------------------------
  window.toggleWordManager = function () {
    if (!hasWordLibAccess) {
      const pwd = prompt("è¯·è¾“å…¥è®¿é—®å¯†ç ï¼š");
      if (pwd !== WORD_LIB_PASSWORD) {
        alert("å¯†ç é”™è¯¯ï¼");
        return;
      }
      hasWordLibAccess = true;
      alert("å·²è¿›å…¥å•è¯ç®¡ç†æ¨¡å¼ï¼");
    }
    document.getElementById('wordManager').classList.toggle('active');
  };

  function renderWordList() {
    const wordList = document.getElementById('wordList');
    wordList.innerHTML = words.map((word, index) => `
      <div class="word-item">
        <div class="word-text">
          <span class="word-en">${word.english}</span>
          <span style="color: #9ca3af;"> - </span>
          <span class="word-cn">${word.chinese}</span>
        </div>
        <div class="word-actions">
          <button class="icon-btn btn-yellow" onclick="startEdit(${index})">âœï¸</button>
          <button class="icon-btn btn-red" onclick="deleteWord(${index})">ğŸ—‘ï¸</button>
        </div>
      </div>
    `).join('');
      
    document.getElementById('wordCount').textContent = words.length;
  }

  window.addWord = async function () {
    const english = englishInput.value.trim().toLowerCase();
    const chinese = chineseInput.value.trim();
    if (!english || !chinese) return;

    words.push({ english, chinese });
    englishInput.value = "";
    chineseInput.value = "";

    await saveWordsToServer();
    renderWordList();
  };

  window.startEdit = function(index) {
    editingIndex = index;
    englishInput.value = words[index].english;
    chineseInput.value = words[index].chinese;

    addBtn.style.display = "none";
    saveBtn.style.display = "block";
    cancelBtn.style.display = "block";
  };

  window.saveEdit = async function() {
    const english = englishInput.value.trim().toLowerCase();
    const chinese = chineseInput.value.trim();

    words[editingIndex] = { english, chinese };
    editingIndex = null;

    englishInput.value = "";
    chineseInput.value = "";

    addBtn.style.display = "block";
    saveBtn.style.display = "none";
    cancelBtn.style.display = "none";

    await saveWordsToServer();
    renderWordList();
    shuffleLetters();
  };

  window.cancelEdit = function() {
    editingIndex = null;
    englishInput.value = "";
    chineseInput.value = "";

    addBtn.style.display = "block";
    saveBtn.style.display = "none";
    cancelBtn.style.display = "none";
  };

  window.deleteWord = async function(index) {
    words.splice(index, 1);

    await saveWordsToServer();
    renderWordList();
    shuffleLetters();
  };

  // -------------------------
  // ğŸš€ å¯åŠ¨æ¸¸æˆ
  // -------------------------
  initGame();
</script>

</body>

</html>
